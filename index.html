<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Match Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            touch-action: manipulation;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            width: 95vw;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        
        .header {
            color: white;
            margin-bottom: 15px;
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .shop-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .stars-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            color: gold;
            font-weight: bold;
            font-size: 14px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
            font-size: 13px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .card {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            color: transparent;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .card.flipped {
            color: white;
            background: rgba(255, 255, 255, 0.25);
        }
        
        .card.matched {
            color: white;
            background: rgba(50, 205, 50, 0.4);
        }
        
        /* Animated emoji styles */
        .animated-emoji {
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(2n) {
            animation-delay: 0.5s;
        }
        
        .animated-emoji:nth-child(3n) {
            animation: bounce 2s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(4n) {
            animation: pulse 4s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(5n) {
            animation: spin 6s linear infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            25% { transform: translateY(-8px); }
            75% { transform: translateY(-3px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: #4ecdc4;
            color: white;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .message {
            color: white;
            margin-top: 15px;
            min-height: 20px;
            font-size: 13px;
        }
        
        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .level-complete.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .level-complete-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        
        .level-complete h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .level-complete p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .next-level-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .splash-screen.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .splash-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 320px;
            width: 90%;
        }
        
        .splash-content h2 {
            color: white;
            font-size: 22px;
            margin-bottom: 15px;
        }
        
        .splash-content p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .splash-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .shop-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .shop-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .shop-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        
        .shop-content h2 {
            color: white;
            font-size: 22px;
            margin-bottom: 15px;
        }
        
        .shop-items {
            margin-bottom: 20px;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            color: white;
        }
        
        .shop-item button {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .shop-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .footer {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 15px;
        }
        
        .orientation-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .orientation-warning.show {
            display: flex;
        }
        
        .orientation-warning h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .orientation-warning p {
            font-size: 18px;
            line-height: 1.5;
        }
        
        .phone-icon {
            font-size: 60px;
            margin-bottom: 20px;
            transform: rotate(90deg);
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            color: white;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingScreen">
        Loading your progress...
    </div>
    
    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="header">
            üéØ Emoji Match Pro
        </div>
        
        <div class="top-row">
            <button class="shop-toggle" onclick="openShop()">Shop</button>
            <div class="stars-display" id="starsDisplay">‚≠ê 0</div>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div>Score</div>
                <div id="score">0</div>
            </div>
            <div class="stat-item">
                <div>High Score</div>
                <div id="highScore">0</div>
            </div>
            <div class="stat-item">
                <div>Moves</div>
                <div id="moves">0</div>
            </div>
            <div class="stat-item">
                <div>Level</div>
                <div id="level">1/100</div>
            </div>
        </div>
        
        <div class="game-board" id="gameBoard"></div>
        
        <div class="controls">
            <button class="btn" onclick="resetGame()">Reset</button>
            <button class="btn" onclick="newGame()">New Game</button>
        </div>
        
        <div class="message" id="message"></div>
        
        <div class="footer">Made with ‚ù£Ô∏è by JayathaSoft</div>
    </div>
    
    <div class="level-complete" id="levelComplete">
        <div class="level-complete-content">
            <h2>üéâ Level Complete!</h2>
            <p id="levelCompleteMessage">Great job! Ready for the next challenge?</p>
            <div id="starsEarned" style="color: gold; font-size: 18px; margin-bottom: 15px;"></div>
            <button class="next-level-btn" onclick="nextLevel()">Next Level</button>
        </div>
    </div>
    
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <h2>Level <span id="splashLevel">1</span> Rules</h2>
            <p id="splashRules">Normal Mode - No restrictions</p>
            <button class="splash-btn" onclick="startGameFromSplash()">Start Game</button>
        </div>
    </div>
    
    <div class="shop-modal" id="shopModal">
        <div class="shop-content">
            <h2>‚≠ê Star Shop</h2>
            <div style="background: rgba(255, 255, 255, 0.2); padding: 10px; border-radius: 10px; margin-bottom: 15px; color: white;">
                You have: <span id="shopStars">0</span> stars
            </div>
            <div class="shop-items">
                <div class="shop-item">
                    +5 Extra Moves<br>
                    <button onclick="buyExtraMoves()">Buy for 10 ‚≠ê</button>
                </div>
                <div class="shop-item">
                    +15 Extra Seconds<br>
                    <button onclick="buyExtraTime()">Buy for 15 ‚≠ê</button>
                </div>
                <div class="shop-item">
                    Remove Move Limit (1 game)<br>
                    <button onclick="buyRemoveMoveLimit()">Buy for 25 ‚≠ê</button>
                </div>
                <div class="shop-item">
                    Remove Time Limit (1 game)<br>
                    <button onclick="buyRemoveTimeLimit()">Buy for 25 ‚≠ê</button>
                </div>
            </div>
            <button class="shop-btn" onclick="closeShop()">Close Shop</button>
        </div>
    </div>
    
    <div class="orientation-warning" id="orientationWarning">
        <div>
            <div class="phone-icon">üì±</div>
            <h2>Portrait Mode Only</h2>
            <p>Please rotate your phone to portrait orientation to play this game.</p>
            <p style="font-size: 14px; margin-top: 10px; opacity: 0.8;">This game is designed for vertical play only.</p>
        </div>
    </div>

    <script>
        // Game state
        let soundEnabled = true;
        let audioContext;
        let backgroundMusic = null;
        let currentLevel = 1;
        let totalLevels = 100;
        let totalStars = 0;
        let extraMoves = 0;
        let extraTime = 0;
        let removeMoveLimit = false;
        let removeTimeLimit = false;
        let currentScore = 0;
        let highScore = 0;
        
        // Game variables
        let gameBoard = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timer = null;
        let seconds = 0;
        let gameStarted = false;
        let moveLimit = 0;
        let timeLimit = 0;
        let baseMoveLimit = 0;
        let baseTimeLimit = 0;
        
        // Check orientation
        function checkOrientation() {
            const warning = document.getElementById('orientationWarning');
            if (window.innerWidth > window.innerHeight) {
                warning.classList.add('show');
            } else {
                warning.classList.remove('show');
            }
        }
        
        // Save game state to localStorage
        function saveGameState() {
            try {
                const gameState = {
                    currentLevel: currentLevel,
                    totalStars: totalStars,
                    highScore: highScore,
                    lastPlayed: new Date().toISOString()
                };
                localStorage.setItem('emojiMatchGameState', JSON.stringify(gameState));
            } catch (e) {
                console.log('Save failed:', e);
            }
        }
        
        // Load game state from localStorage
        function loadGameState() {
            try {
                const saved = localStorage.getItem('emojiMatchGameState');
                if (saved) {
                    const gameState = JSON.parse(saved);
                    currentLevel = gameState.currentLevel || 1;
                    totalStars = gameState.totalStars || 0;
                    highScore = gameState.highScore || 0;
                    return true;
                }
                return false;
            } catch (e) {
                console.log('Load failed:', e);
                return false;
            }
        }
        
        // FIXED: Pre-defined emoji sets for all 100 levels
        const levelIcons = {
            1: ['üòÄ', 'üòÇ', 'ü•∞', 'üòé', 'ü§©', 'üòç', 'ü•≥', 'üòú'],
            2: ['üçé', 'üçå', 'üçí', 'üçá', 'üçä', 'üçã', 'üçë', 'üçì'],
            3: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üèâ', 'üé±'],
            4: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'],
            5: ['‚ù§Ô∏è', 'üíô', 'üíö', 'üíõ', 'üíú', 'üß°', 'üñ§', 'ü§ç'],
            6: ['üçï', 'üçî', 'üçü', 'üå≠', 'üç¶', 'üç©', 'üéÇ', 'üç´'],
            7: ['üöÄ', '‚úàÔ∏è', 'üöÇ', 'üöó', 'üö≤', 'üöÅ', 'üö¢', 'üèçÔ∏è'],
            8: ['üåü', '‚ú®', '‚≠ê', 'üí´', 'üî•', 'üíØ', 'üéØ', 'üèÜ'],
            9: ['üé≠', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å'],
            10: ['üåà', '‚òÄÔ∏è', 'üåô', '‚≠ê', '‚òÅÔ∏è', '‚ö°', '‚ùÑÔ∏è', '‚õÑ'],
            11: ['ü§ì', 'ü§ó', 'ü§ë', 'ü§†', 'üòà', 'üëª', 'ü§ñ', 'üëΩ'],
            12: ['üçâ', 'üçà', 'üçä', 'üçã', 'üçå', 'üçç', 'ü•≠', 'üçé'],
            13: ['ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'üèì', 'üè∏'],
            14: ['üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üêî'],
            15: ['ü§é', 'üíñ', 'üíó', 'üíì', 'üíï', 'üíû', 'üíù', 'üíü'],
            16: ['üçø', 'üßÉ', 'üßâ', 'üßä', 'ü•°', 'üç±', 'üçò', 'üçô'],
            17: ['üöå', 'üöï', 'üöô', 'üöö', 'üöõ', 'üöú', 'üèéÔ∏è', 'üöì'],
            18: ['ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è', 'üèµÔ∏è', 'üéÑ', 'üéÅ'],
            19: ['üé∑', 'üé∫', 'üé∏', 'üéª', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥'],
            20: ['‚òÇÔ∏è', '‚òî', 'üåä', 'üíß', 'üî•', 'üí•', '‚ú®', 'üí´'],
            21: ['üëæ', 'üëã', 'üëç', 'üëè', 'üôå', 'üëê', 'ü§ù', 'üôè'],
            22: ['üçè', 'üçê', 'üçë', 'üçí', 'üçì', 'ü•ù', 'üçÖ', 'ü••'],
            23: ['ü•ç', 'üèí', 'ü•å', '‚õ≥', 'üèπ', 'üé£', 'ü•ä', 'ü•ã'],
            24: ['üêß', 'ü¶Ñ', 'üêù', 'ü¶ã', 'üêå', 'üêû', 'ü¶ü', 'ü¶†'],
            25: ['üåà', 'üí°', 'üîã', 'üîå', 'üíª', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è'],
            26: ['üç™', 'ü•†', 'ü•Æ', 'üç∞', 'üßÅ', 'ü•ß', 'üç´', 'üç¨'],
            27: ['üöë', 'üöí', 'üöì', 'üöï', 'üöó', 'üöô', 'üöå', 'üöé'],
            28: ['üéâ', 'üéä', 'üéà', 'üéÇ', 'üéÅ', 'üéÄ', 'üèÜ', 'üèÖ'],
            29: ['üéÆ', 'üïπÔ∏è', 'üé∞', 'üé≤', 'üß©', 'üß∏', '‚ôüÔ∏è', 'üÉè'],
            30: ['üí®', 'üå¨Ô∏è', 'üå™Ô∏è', 'üå´Ô∏è', 'üåä', 'üíß', '‚òî', '‚ö°'],
            31: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£'],
            32: ['üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞'],
            33: ['üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú'],
            34: ['ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü•∏', 'ü§©', 'ü•≥'],
            35: ['üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è'],
            36: ['üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§'],
            37: ['üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±'],
            38: ['üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´'],
            39: ['ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶'],
            40: ['üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ'],
            41: ['ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï'],
            42: ['ü§ë', 'ü§†', 'üòà', 'üëø', 'üëπ', 'üë∫', 'ü§°', 'üí©'],
            43: ['üëª', 'üíÄ', '‚ò†Ô∏è', 'üëΩ', 'üëæ', 'ü§ñ', 'üéÉ', 'üò∫'],
            44: ['üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'],
            45: ['üôà', 'üôâ', 'üôä', 'üíå', 'üíò', 'üíù', 'üíñ', 'üíó'],
            46: ['üíì', 'üíû', 'üíï', 'üíü', '‚ù£Ô∏è', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π'],
            47: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'ü§é', 'üñ§'],
            48: ['ü§ç', 'üåà', '‚ú®', 'üåü', '‚≠ê', 'üí´', 'üî•', 'üí•'],
            49: ['üíØ', 'üéØ', 'üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è'],
            50: ['üèµÔ∏è', '.Ribbon', 'üéÅ', 'üéÑ', 'üéÉ', 'üßß', 'üéÄ', 'üéì'],
            51: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ'],
            52: ['ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'ü•ç', 'üèè'],
            53: ['üèë', 'ü•å', 'üõ∑', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'üèãÔ∏è', 'ü§º'],
            54: ['ü§∏', '‚õπÔ∏è', 'ü§∫', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ'],
            55: ['üèä', 'ü§Ω', 'üö£', 'üßó', 'üöµ', 'üö¥', 'üèÅ', 'üö©'],
            56: ['üéå', 'üè¥', 'üè≥Ô∏è', 'üè≥Ô∏è‚Äçüåà', 'üá¶üá®', 'üá¶üá©', 'üá¶üá™', 'üá¶üá´'],
            57: ['üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì'],
            58: ['üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ'],
            59: ['üçÜ', 'ü•ë', 'ü•¶', 'ü•¨', 'ü•í', 'üå∂Ô∏è', 'üåΩ', 'ü•ï'],
            60: ['ü•î', 'üç†', 'ü•ê', 'ü•ñ', 'üçû', 'ü•®', 'üßÄ', 'ü•ö'],
            61: ['üç≥', 'üßà', 'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçñ'],
            62: ['ü¶¥', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü•™', 'ü•ô', 'üßÜ'],
            63: ['üåÆ', 'üåØ', 'ü•ó', 'ü•ò', 'üç≤', 'ü•£', 'üçù', 'üçú'],
            64: ['üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô'],
            65: ['üçö', 'üçò', 'üç•', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ'],
            66: ['üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø', 'üç©'],
            67: ['üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', '‚òï', 'üçµ'],
            68: ['üßÉ', 'ü•§', 'üßã', 'üç∫', 'üçª', 'ü•Ç', 'üç∑', 'ü•É'],
            69: ['üç∏', 'üçπ', 'üçæ', 'üßä', 'ü•Ñ', 'üç¥', 'üçΩÔ∏è', 'ü•£'],
            70: ['ü•ó', 'ü•ò', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±'],
            71: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'],
            72: ['üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üêî'],
            73: ['üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â'],
            74: ['ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã'],
            75: ['üêå', 'üêû', 'üêú', 'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'ü¶Ç', 'üê¢'],
            76: ['üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û'],
            77: ['ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à'],
            78: ['üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'üêò', 'ü¶õ'],
            79: ['ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ'],
            80: ['üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï'],
            81: ['üê©', 'üêà', 'üêá', 'üêøÔ∏è', 'ü¶´', 'ü¶î', 'ü¶á', 'ü¶•'],
            82: ['ü¶¶', 'ü¶®', 'ü¶ò', 'ü¶°', 'üêæ', 'üêâ', 'üê≤', 'üåµ'],
            83: ['üéÑ', 'üå≤', 'üå≥', 'üå¥', 'üå±', 'üåø', '‚òòÔ∏è', 'üçÄ'],
            84: ['üéç', 'üéã', 'üçÉ', 'üçÇ', 'üçÅ', 'üçÑ', 'üåæ', 'üíê'],
            85: ['üå∑', 'üåπ', 'ü•Ä', 'üå∫', 'üå∏', 'üåº', 'üåª', 'üåû'],
            86: ['üåù', 'üåõ', 'üåú', 'üåö', 'üåï', 'üåñ', 'üåó', 'üåò'],
            87: ['üåë', 'üåí', 'üåì', 'üåî', 'üåï', 'üåñ', 'üåó', 'üåò'],
            88: ['üåç', 'üåé', 'üåè', 'üåê', 'üó∫Ô∏è', 'üóæ', 'üß≠', 'üèîÔ∏è'],
            89: ['‚õ∞Ô∏è', 'üåã', 'üóª', 'üèïÔ∏è', 'üèñÔ∏è', 'üèúÔ∏è', 'üèùÔ∏è', 'üèûÔ∏è'],
            90: ['üèüÔ∏è', 'üèõÔ∏è', 'üèóÔ∏è', 'üß±', 'üèòÔ∏è', 'üèöÔ∏è', 'üè†', 'üè°'],
            91: ['üè¢', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®', 'üè©', 'üè™'],
            92: ['üè´', 'üè¨', 'üè≠', 'üèØ', 'üè∞', 'üíí', 'üóº', 'üóΩ'],
            93: ['‚õ™', 'üïå', 'üïç', '‚õ©Ô∏è', 'üïã', '‚õ≤', '‚õ∫', 'üåÅ'],
            94: ['üåÉ', 'üèôÔ∏è', 'üåÑ', 'üåÖ', 'üåÜ', 'üåá', 'üåâ', '‚ô®Ô∏è'],
            95: ['üé†', 'üé°', 'üé¢', 'üíà', 'üé™', 'üöÇ', 'üöÉ', 'üöÑ'],
            96: ['üöÖ', 'üöÜ', 'üöá', 'üöà', 'üöâ', 'üöä', 'üöù', 'üöû'],
            97: ['üöã', 'üöå', 'üöç', 'üöé', 'üöê', 'üöë', 'üöí', 'üöì'],
            98: ['üöî', 'üöï', 'üöñ', 'üöó', 'üöò', 'üöô', 'üõª', 'üöö'],
            99: ['üöõ', 'üöú', 'üèéÔ∏è', 'üèçÔ∏è', 'üõµ', 'ü¶Ω', 'ü¶º', 'üõ¥'],
            100: ['üö≤', 'üõ¥', 'üõπ', 'üõ∫', 'üöè', 'üõ£Ô∏è', 'üõ§Ô∏è', 'üõ¢Ô∏è']
        };
        
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Play sound effect
        function playSound(frequency, duration = 0.2, type = 'sine') {
            if (!soundEnabled) return;
            
            try {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.value = 0.1;
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                setTimeout(() => {
                    oscillator.stop();
                }, duration * 1000);
            } catch (e) {
                console.log('Audio error:', e);
            }
        }
        
        // Background music
        function playBackgroundMusic() {
            if (!soundEnabled || backgroundMusic) return;
            
            try {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 2);
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 4);
                oscillator.frequency.setValueAtTime(220, audioContext.currentTime + 6);
                
                gainNode.gain.value = 0.03;
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 8);
                
                backgroundMusic = setTimeout(playBackgroundMusic, 8000);
            } catch (e) {
                console.log('Background music error:', e);
            }
        }
        
        function stopBackgroundMusic() {
            if (backgroundMusic) {
                clearTimeout(backgroundMusic);
                backgroundMusic = null;
            }
        }
        
        // Sound effects
        function playCardFlipSound() { playSound(600, 0.1, 'sine'); }
        function playMatchSound() { playSound(800, 0.3, 'sine'); setTimeout(() => playSound(1000, 0.3, 'sine'), 100); }
        function playNoMatchSound() { playSound(300, 0.2, 'sawtooth'); }
        function playWinSound() { 
            playSound(500, 0.2, 'sine');
            setTimeout(() => playSound(700, 0.2, 'sine'), 150);
            setTimeout(() => playSound(900, 0.2, 'sine'), 300);
            setTimeout(() => playSound(1100, 0.3, 'sine'), 450);
        }
        
        // Get difficulty settings
        function getDifficultySettings(level) {
            if (level <= 10) {
                return { moveLimit: 0, timeLimit: 0, description: 'Normal Mode', splashText: 'Normal Mode - No restrictions' };
            } else if (level <= 30) {
                return { moveLimit: 20, timeLimit: 0, description: 'Move Limit: 20', splashText: 'You have only 20 moves to complete this level!' };
            } else if (level <= 60) {
                return { moveLimit: 0, timeLimit: 60, description: 'Time Limit: 60s', splashText: 'Complete within 60 seconds!' };
            } else if (level <= 80) {
                return { moveLimit: 25, timeLimit: 45, description: 'Move: 25, Time: 45s', splashText: 'Challenging! 25 moves and 45 seconds only!' };
            } else {
                return { moveLimit: 18, timeLimit: 30, description: 'Hard Mode!', splashText: 'Extreme Challenge! Only 18 moves and 30 seconds!' };
            }
        }
        
        // Calculate stars earned
        function calculateStarsEarned() {
            const difficulty = getDifficultySettings(currentLevel);
            let stars = 0;
            
            // Base stars for completing level
            stars += 5;
            
            // Bonus for moves saved
            if (difficulty.moveLimit > 0) {
                const movesSaved = difficulty.moveLimit - moves;
                if (movesSaved > 0) {
                    stars += Math.floor(movesSaved * 0.5);
                }
            }
            
            // Bonus for time saved
            if (difficulty.timeLimit > 0) {
                const timeSaved = difficulty.timeLimit - seconds;
                if (timeSaved > 0) {
                    stars += Math.floor(timeSaved * 0.3);
                }
            }
            
            // Bonus for perfect completion
            if (moves === 8 && difficulty.moveLimit === 0 && difficulty.timeLimit === 0) {
                stars += 10; // Perfect in normal mode
            }
            
            return Math.max(stars, 1); // Minimum 1 star
        }
        
        // Calculate score - FIXED VERSION
        function calculateScore() {
            const difficulty = getDifficultySettings(currentLevel);
            let score = 0;
            
            // Base score for completing level
            if (matchedPairs === 8) {
                score = 1000;
                
                // Deduct for moves used
                score -= (moves * 10);
                
                // Deduct for time used
                score -= (seconds * 5);
                
                // Bonus for difficulty
                if (currentLevel > 10) score += 200;
                if (currentLevel > 30) score += 300;
                if (currentLevel > 60) score += 400;
                if (currentLevel > 80) score += 500;
                
                // Bonus for stars earned
                const stars = calculateStarsEarned();
                score += (stars * 20);
            } else {
                // During gameplay, calculate potential score
                score = 1000 - (moves * 10) - (seconds * 5);
                if (currentLevel > 10) score += 200;
                if (currentLevel > 30) score += 300;
                if (currentLevel > 60) score += 400;
                if (currentLevel > 80) score += 500;
            }
            
            return Math.max(score, 0);
        }
        
        // Initialize the game
        function initGame() {
            stopBackgroundMusic();
            const gameBoardElement = document.getElementById('gameBoard');
            gameBoardElement.innerHTML = '';
            
            // Apply shop bonuses
            const difficulty = getDifficultySettings(currentLevel);
            baseMoveLimit = difficulty.moveLimit;
            baseTimeLimit = difficulty.timeLimit;
            
            moveLimit = removeMoveLimit ? 0 : (baseMoveLimit + extraMoves);
            timeLimit = removeTimeLimit ? 0 : (baseTimeLimit + extraTime);
            
            // Reset shop bonuses after use
            extraMoves = 0;
            extraTime = 0;
            removeMoveLimit = false;
            removeTimeLimit = false;
            
            // Get icons - NOW GUARANTEED TO WORK FOR ALL LEVELS
            const icons = levelIcons[currentLevel];
            
            // Validate that we have valid emojis (this should never fail now)
            if (!icons || icons.length !== 8) {
                console.error(`Invalid emoji set for level ${currentLevel}`);
                // Fallback to level 1 emojis
                const fallbackIcons = levelIcons[1];
                let iconPairs = [...fallbackIcons, ...fallbackIcons];
                // Shuffle fallback
                for (let i = iconPairs.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [iconPairs[i], iconPairs[j]] = [iconPairs[j], iconPairs[i]];
                }
                gameBoard = iconPairs.map((icon, index) => ({
                    id: index,
                    icon: icon,
                    isFlipped: false,
                    isMatched: false
                }));
            } else {
                // Create pairs
                let iconPairs = [...icons, ...icons];
                
                // Shuffle
                for (let i = iconPairs.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [iconPairs[i], iconPairs[j]] = [iconPairs[j], iconPairs[i]];
                }
                
                // Create game board
                gameBoard = iconPairs.map((icon, index) => ({
                    id: index,
                    icon: icon,
                    isFlipped: false,
                    isMatched: false
                }));
            }
            
            // Render cards
            gameBoard.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.id = card.id;
                cardElement.addEventListener('click', () => flipCard(card.id));
                cardElement.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    flipCard(card.id);
                });
                gameBoardElement.appendChild(cardElement);
            });
            
            // Reset game state
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            seconds = 0;
            currentScore = 0;
            gameStarted = false;
            clearInterval(timer);
            
            // Update UI
            updateStats();
            document.getElementById('message').textContent = difficulty.description;
            updateStarsDisplay();
        }
        
        // Show splash screen for special levels
        function showSplashScreen() {
            const difficulty = getDifficultySettings(currentLevel);
            if (currentLevel > 10) { // Show splash for levels 11+
                document.getElementById('splashLevel').textContent = currentLevel;
                document.getElementById('splashRules').textContent = difficulty.splashText;
                document.getElementById('splashScreen').classList.add('show');
            } else {
                initGame();
            }
        }
        
        function startGameFromSplash() {
            document.getElementById('splashScreen').classList.remove('show');
            initGame();
        }
        
        // Flip a card
        function flipCard(cardId) {
            const card = gameBoard[cardId];
            
            if (card.isFlipped || card.isMatched || flippedCards.length >= 2) {
                return;
            }
            
            // Check move limit
            if (moveLimit > 0 && moves >= moveLimit) {
                document.getElementById('message').textContent = '‚ùå Move limit reached!';
                return;
            }
            
            // Start timer and background music on first move
            if (!gameStarted) {
                startTimer();
                gameStarted = true;
                if (soundEnabled) {
                    playBackgroundMusic();
                }
            }
            
            // Flip the card
            card.isFlipped = true;
            flippedCards.push(cardId);
            
            // Update UI with animated emoji
            const cardElement = document.querySelector(`[data-id="${cardId}"]`);
            const animatedEmoji = document.createElement('span');
            animatedEmoji.className = 'animated-emoji';
            animatedEmoji.textContent = card.icon;
            cardElement.innerHTML = '';
            cardElement.appendChild(animatedEmoji);
            cardElement.classList.add('flipped');
            
            // Play sound
            playCardFlipSound();
            
            // Check for match if two cards are flipped
            if (flippedCards.length === 2) {
                moves++;
                updateStats(); // Update stats immediately when moves increase
                setTimeout(checkMatch, 500);
            }
        }
        
        // Check if flipped cards match
        function checkMatch() {
            const [firstId, secondId] = flippedCards;
            const firstCard = gameBoard[firstId];
            const secondCard = gameBoard[secondId];
            
            if (firstCard.icon === secondCard.icon) {
                firstCard.isMatched = true;
                secondCard.isMatched = true;
                matchedPairs++;
                
                const firstElement = document.querySelector(`[data-id="${firstId}"]`);
                const secondElement = document.querySelector(`[data-id="${secondId}"]`);
                firstElement.classList.add('matched');
                secondElement.classList.add('matched');
                
                playMatchSound();
                
                if (matchedPairs === 8) {
                    endLevel();
                }
            } else {
                firstCard.isFlipped = false;
                secondCard.isFlipped = false;
                
                const firstElement = document.querySelector(`[data-id="${firstId}"]`);
                const secondElement = document.querySelector(`[data-id="${secondId}"]`);
                firstElement.classList.remove('flipped');
                secondElement.classList.remove('flipped');
                firstElement.innerHTML = '';
                secondElement.innerHTML = '';
                
                playNoMatchSound();
            }
            
            flippedCards = [];
            updateStats(); // Update stats after match check
        }
        
        // Start the timer
        function startTimer() {
            if (timeLimit > 0) {
                document.getElementById('time').textContent = `${timeLimit}s`;
            }
            
            timer = setInterval(() => {
                seconds++;
                updateStats(); // Update stats every second
                
                if (timeLimit > 0) {
                    const remainingTime = timeLimit - seconds;
                    if (remainingTime <= 0) {
                        clearInterval(timer);
                        document.getElementById('message').textContent = '‚è∞ Time\'s up! Game Over.';
                        setTimeout(() => resetGame(), 3000);
                    } else {
                        document.getElementById('time').textContent = `${remainingTime}s`;
                    }
                }
            }, 1000);
        }
        
        // End the current level
        function endLevel() {
            clearInterval(timer);
            stopBackgroundMusic();
            
            const starsEarned = calculateStarsEarned();
            totalStars += starsEarned;
            currentScore = calculateScore();
            
            // Update high score if current score is higher
            if (currentScore > highScore) {
                highScore = currentScore;
            }
            
            saveGameState();
            playWinSound();
            
            if (currentLevel < totalLevels) {
                const levelComplete = document.getElementById('levelComplete');
                const message = document.getElementById('levelCompleteMessage');
                message.innerHTML = `Level ${currentLevel} Complete!<br>Score: ${currentScore}<br>Moves: ${moves}<br>Time: ${seconds}s`;
                document.getElementById('starsEarned').innerHTML = `‚≠ê +${starsEarned} Stars!`;
                levelComplete.classList.add('show');
            } else {
                document.getElementById('message').textContent = `üèÜ Game Complete! All ${totalLevels} levels finished!`;
            }
            
            updateStarsDisplay();
            updateStats(); // Final update
        }
        
        // Go to next level
        function nextLevel() {
            currentLevel++;
            saveGameState();
            const levelComplete = document.getElementById('levelComplete');
            levelComplete.classList.remove('show');
            showSplashScreen();
        }
        
        // Update statistics display - FIXED VERSION
        function updateStats() {
            // Always recalculate current score
            currentScore = calculateScore();
            
            // Update all displays
            document.getElementById('score').textContent = currentScore;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('moves').textContent = moves;
            document.getElementById('level').textContent = `${currentLevel}/${totalLevels}`;
        }
        
        // Update stars display
        function updateStarsDisplay() {
            document.getElementById('starsDisplay').textContent = `‚≠ê ${totalStars}`;
            document.getElementById('shopStars').textContent = totalStars;
        }
        
        // Reset the current game
        function resetGame() {
            clearInterval(timer);
            stopBackgroundMusic();
            showSplashScreen();
        }
        
        // Start a new game
        function newGame() {
            if (confirm('Start a new game? Your current progress will be lost.')) {
                currentLevel = 1;
                totalStars = 0;
                highScore = 0;
                saveGameState();
                showSplashScreen();
            }
        }
        
        // Shop functions
        function openShop() {
            document.getElementById('shopModal').classList.add('show');
            updateStarsDisplay();
        }
        
        function closeShop() {
            document.getElementById('shopModal').classList.remove('show');
        }
        
        function buyExtraMoves() {
            if (totalStars >= 10) {
                totalStars -= 10;
                extraMoves += 5;
                saveGameState();
                updateStarsDisplay();
                alert('‚úÖ +5 Extra Moves purchased!');
                closeShop();
            } else {
                alert('‚ùå Not enough stars! Need 10 stars.');
            }
        }
        
        function buyExtraTime() {
            if (totalStars >= 15) {
                totalStars -= 15;
                extraTime += 15;
                saveGameState();
                updateStarsDisplay();
                alert('‚úÖ +15 Extra Seconds purchased!');
                closeShop();
            } else {
                alert('‚ùå Not enough stars! Need 15 stars.');
            }
        }
        
        function buyRemoveMoveLimit() {
            if (totalStars >= 25) {
                totalStars -= 25;
                removeMoveLimit = true;
                saveGameState();
                updateStarsDisplay();
                alert('‚úÖ Move limit removed for this game!');
                closeShop();
            } else {
                alert('‚ùå Not enough stars! Need 25 stars.');
            }
        }
        
        function buyRemoveTimeLimit() {
            if (totalStars >= 25) {
                totalStars -= 25;
                removeTimeLimit = true;
                saveGameState();
                updateStarsDisplay();
                alert('‚úÖ Time limit removed for this game!');
                closeShop();
            } else {
                alert('‚ùå Not enough stars! Need 25 stars.');
            }
        }
        
        // Initialize the game when page loads
        window.onload = function() {
            const loadingScreen = document.getElementById('loadingScreen');
            const gameContainer = document.getElementById('gameContainer');
            
            // Load saved game state
            const loaded = loadGameState();
            
            // Hide loading and show game
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                gameContainer.style.display = 'block';
                
                if (loaded) {
                    document.getElementById('message').textContent = `Welcome back! Continue from Level ${currentLevel}`;
                    setTimeout(() => {
                        showSplashScreen();
                    }, 1000);
                } else {
                    showSplashScreen();
                }
            }, 500);
            
            checkOrientation();
            document.body.addEventListener('touchstart', initAudio, { once: true });
            document.body.addEventListener('click', initAudio, { once: true });
        };
        
        // Handle orientation changes
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', function() {
            setTimeout(checkOrientation, 100);
        });
        
        // Auto-save every 30 seconds
        setInterval(saveGameState, 30000);
    </script>
</body>
</html>
