<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Match Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            touch-action: manipulation;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            width: 95vw;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        
        .header {
            color: white;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px;
        }
        
        .title-section {
            flex: 1;
            text-align: center;
        }
        
        
        
        .stars-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 15px;
            color: gold;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .shop-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .card {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            color: transparent;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .card.flipped {
            color: white;
            background: rgba(255, 255, 255, 0.25);
        }
        
        .card.matched {
            color: white;
            background: rgba(50, 205, 50, 0.4);
        }
        
        /* Animated emoji styles */
        .animated-emoji {
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(2n) {
            animation-delay: 0.5s;
        }
        
        .animated-emoji:nth-child(3n) {
            animation: bounce 2s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(4n) {
            animation: pulse 4s ease-in-out infinite;
        }
        
        .animated-emoji:nth-child(5n) {
            animation: spin 6s linear infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            25% { transform: translateY(-8px); }
            75% { transform: translateY(-3px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: #4ecdc4;
            color: white;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        
        .message {
            color: white;
            margin-top: 15px;
            min-height: 20px;
        }
        
        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .level-complete.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .level-complete-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        
        .level-complete h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .level-complete p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        .next-level-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .splash-screen.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .splash-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 320px;
            width: 90%;
        }
        
        .splash-content h2 {
            color: white;
            font-size: 22px;
            margin-bottom: 15px;
        }
        
        .splash-content p {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .splash-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .shop-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .shop-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .shop-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        
        .shop-content h2 {
            color: white;
            font-size: 22px;
            margin-bottom: 15px;
        }
        
        .shop-items {
            margin-bottom: 20px;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            color: white;
        }
        
        .shop-item button {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .shop-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .footer {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="top-controls">
            <button class="shop-toggle" onclick="openShop()">ğŸ›’ Shop</button>
            <div class="title-section">
                <div class="header">
                    <span>Emoji Match</span>
                    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>
                </div>
            </div>
            <div class="stars-display" id="starsDisplay">â­ 0</div>
        </div>
        
        <div class="stats">
            <div>Moves: <span id="moves">0</span></div>
            <div>Time: <span id="time">0s</span></div>
            <div>Level: <span id="level">1/100</span></div>
        </div>
        
        <div class="game-board" id="gameBoard"></div>
        
        <div class="controls">
            <button class="btn" onclick="resetGame()">Reset</button>
            <button class="btn" onclick="newGame()">New Game</button>
        </div>
        
        <div class="message" id="message"></div>
        
        <div class="footer">Made with â£ï¸ by JayathaSoft</div>
    </div>
    
    <div class="level-complete" id="levelComplete">
        <div class="level-complete-content">
            <h2>ğŸ‰ Level Complete!</h2>
            <p id="levelCompleteMessage">Great job! Ready for the next challenge?</p>
            <div id="starsEarned" style="color: gold; font-size: 18px; margin-bottom: 15px;"></div>
            <button class="next-level-btn" onclick="nextLevel()">Next Level</button>
        </div>
    </div>
    
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <h2>Level <span id="splashLevel">1</span> Rules</h2>
            <p id="splashRules">Normal Mode - No restrictions</p>
            <button class="splash-btn" onclick="startGameFromSplash()">Start Game</button>
        </div>
    </div>
    
    <div class="shop-modal" id="shopModal">
        <div class="shop-content">
            <h2>â­ Star Shop</h2>
            <div style="background: rgba(255, 255, 255, 0.2); padding: 10px; border-radius: 10px; margin-bottom: 15px; color: white;">
                You have: <span id="shopStars">0</span> stars
            </div>
            <div class="shop-items">
                <div class="shop-item">
                    +5 Extra Moves<br>
                    <button onclick="buyExtraMoves()">Buy for 10 â­</button>
                </div>
                <div class="shop-item">
                    +15 Extra Seconds<br>
                    <button onclick="buyExtraTime()">Buy for 15 â­</button>
                </div>
                <div class="shop-item">
                    Remove Move Limit (1 game)<br>
                    <button onclick="buyRemoveMoveLimit()">Buy for 25 â­</button>
                </div>
                <div class="shop-item">
                    Remove Time Limit (1 game)<br>
                    <button onclick="buyRemoveTimeLimit()">Buy for 25 â­</button>
                </div>
            </div>
            <button class="shop-btn" onclick="closeShop()">Close Shop</button>
        </div>
    </div>

    <script>
        // Game state
        let soundEnabled = true;
        let audioContext;
        let backgroundMusic = null;
        let currentLevel = 1;
        let totalLevels = 100;
        let totalStars = 0;
        let extraMoves = 0;
        let extraTime = 0;
        let removeMoveLimit = false;
        let removeTimeLimit = false;
        
        // Game variables
        let gameBoard = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timer = null;
        let seconds = 0;
        let gameStarted = false;
        let moveLimit = 0;
        let timeLimit = 0;
        let baseMoveLimit = 0;
        let baseTimeLimit = 0;
        
        // Generate 100 different emoji sets
        const generateEmojiSets = () => {
            const baseEmojis = [
                'ğŸ˜€', 'ğŸ˜‚', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜', 'ğŸ¥³', 'ğŸ˜œ', 'ğŸ¤“', 'ğŸ¤—', 'ğŸ¤‘', 'ğŸ¤ ', 'ğŸ˜ˆ', 'ğŸ‘»', 'ğŸ¤–', 'ğŸ‘½',
                'ğŸ', 'ğŸŒ', 'ğŸ’', 'ğŸ‡', 'ğŸŠ', 'ğŸ‹', 'ğŸ‘', 'ğŸ“', 'ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸŒ­', 'ğŸ¦', 'ğŸ©', 'ğŸ‚', 'ğŸ«',
                'âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ±', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ¥…', 'â›³', 'ğŸ¹', 'ğŸ£', 'ğŸ¥Š',
                'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”',
                'â¤ï¸', 'ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ’œ', 'ğŸ§¡', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’•', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ',
                'ğŸš€', 'âœˆï¸', 'ğŸš‚', 'ğŸš—', 'ğŸš²', 'ğŸš', 'ğŸš¢', 'ğŸï¸', 'ğŸšŒ', 'ğŸš•', 'ğŸš™', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸš“',
                'ğŸŒŸ', 'âœ¨', 'â­', 'ğŸ’«', 'ğŸ”¥', 'ğŸ’¯', 'ğŸ¯', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–ï¸', 'ğŸµï¸', 'ğŸ„', 'ğŸ',
                'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ™', 'â­', 'â˜ï¸', 'âš¡', 'â„ï¸', 'â›„', 'â˜‚ï¸', 'â˜”', 'ğŸŒŠ', 'ğŸ’§', 'ğŸ”¥', 'ğŸ’¥', 'âœ¨', 'ğŸ’«',
                'ğŸ­', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸ·', 'ğŸº', 'ğŸ¸', 'ğŸ»', 'ğŸ²', 'â™Ÿï¸', 'ğŸ¯', 'ğŸ³',
                'ğŸ§©', 'ğŸ§¸', 'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ²', 'â™ ï¸', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸', 'ğŸƒ', 'ğŸ€„', 'ğŸ´', 'ğŸ­', 'ğŸ–¼ï¸', 'ğŸ¨', 'ğŸ§µ'
            ];
            
            const emojiSets = {};
            for (let i = 1; i <= 100; i++) {
                const startIndex = (i - 1) * 3;
                const levelEmojis = [];
                for (let j = 0; j < 8; j++) {
                    const emojiIndex = (startIndex + j) % baseEmojis.length;
                    levelEmojis.push(baseEmojis[emojiIndex]);
                }
                emojiSets[i] = levelEmojis;
            }
            return emojiSets;
        };
        
        const levelIcons = generateEmojiSets();
        
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Play sound effect
        function playSound(frequency, duration = 0.2, type = 'sine') {
            if (!soundEnabled) return;
            
            try {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.value = 0.1;
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                setTimeout(() => {
                    oscillator.stop();
                }, duration * 1000);
            } catch (e) {
                console.log('Audio error:', e);
            }
        }
        
        // Background music
        function playBackgroundMusic() {
            if (!soundEnabled || backgroundMusic) return;
            
            try {
                initAudio();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 2);
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 4);
                oscillator.frequency.setValueAtTime(220, audioContext.currentTime + 6);
                
                gainNode.gain.value = 0.03;
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 8);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 8);
                
                backgroundMusic = setTimeout(playBackgroundMusic, 8000);
            } catch (e) {
                console.log('Background music error:', e);
            }
        }
        
        function stopBackgroundMusic() {
            if (backgroundMusic) {
                clearTimeout(backgroundMusic);
                backgroundMusic = null;
            }
        }
        
        // Sound effects
        function playCardFlipSound() { playSound(600, 0.1, 'sine'); }
        function playMatchSound() { playSound(800, 0.3, 'sine'); setTimeout(() => playSound(1000, 0.3, 'sine'), 100); }
        function playNoMatchSound() { playSound(300, 0.2, 'sawtooth'); }
        function playWinSound() { 
            playSound(500, 0.2, 'sine');
            setTimeout(() => playSound(700, 0.2, 'sine'), 150);
            setTimeout(() => playSound(900, 0.2, 'sine'), 300);
            setTimeout(() => playSound(1100, 0.3, 'sine'), 450);
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundToggle = document.getElementById('soundToggle');
            if (soundEnabled) {
                soundToggle.textContent = 'ğŸ”Š';
                soundToggle.classList.remove('muted');
                if (gameStarted) playBackgroundMusic();
            } else {
                soundToggle.textContent = 'ğŸ”‡';
                soundToggle.classList.add('muted');
                stopBackgroundMusic();
            }
        }
        
        // Get difficulty settings
        function getDifficultySettings(level) {
            if (level <= 10) {
                return { moveLimit: 0, timeLimit: 0, description: 'Normal Mode', splashText: 'Normal Mode - No restrictions' };
            } else if (level <= 30) {
                return { moveLimit: 20, timeLimit: 0, description: 'Move Limit: 20', splashText: 'You have only 20 moves to complete this level!' };
            } else if (level <= 60) {
                return { moveLimit: 0, timeLimit: 60, description: 'Time Limit: 60s', splashText: 'Complete within 60 seconds!' };
            } else if (level <= 80) {
                return { moveLimit: 25, timeLimit: 45, description: 'Move: 25, Time: 45s', splashText: 'Challenging! 25 moves and 45 seconds only!' };
            } else {
                return { moveLimit: 18, timeLimit: 30, description: 'Hard Mode!', splashText: 'Extreme Challenge! Only 18 moves and 30 seconds!' };
            }
        }
        
        // Calculate stars earned
        function calculateStarsEarned() {
            const difficulty = getDifficultySettings(currentLevel);
            let stars = 0;
            
            // Base stars for completing level
            stars += 5;
            
            // Bonus for moves saved
            if (difficulty.moveLimit > 0) {
                const movesSaved = difficulty.moveLimit - moves;
                if (movesSaved > 0) {
                    stars += Math.floor(movesSaved * 0.5);
                }
            }
            
            // Bonus for time saved
            if (difficulty.timeLimit > 0) {
                const timeSaved = difficulty.timeLimit - seconds;
                if (timeSaved > 0) {
                    stars += Math.floor(timeSaved * 0.3);
                }
            }
            
            // Bonus for perfect completion
            if (moves === 8 && difficulty.moveLimit === 0 && difficulty.timeLimit === 0) {
                stars += 10; // Perfect in normal mode
            }
            
            return Math.max(stars, 1); // Minimum 1 star
        }
        
        // Save game state (would work in real browser)
        function saveGameState() {
            try {
                const gameState = {
                    currentLevel: currentLevel,
                    totalStars: totalStars
                };
                // localStorage.setItem('emojiMatchGameState', JSON.stringify(gameState));
            } catch (e) {
                console.log('Save failed:', e);
            }
        }
        
        // Load game state (would work in real browser)
        function loadGameState() {
            try {
                // const saved = localStorage.getItem('emojiMatchGameState');
                // if (saved) {
                //     const gameState = JSON.parse(saved);
                //     currentLevel = gameState.currentLevel || 1;
                //     totalStars = gameState.totalStars || 0;
                // }
            } catch (e) {
                console.log('Load failed:', e);
            }
        }
        
        // Initialize the game
        function initGame() {
            stopBackgroundMusic();
            const gameBoardElement = document.getElementById('gameBoard');
            gameBoardElement.innerHTML = '';
            
            // Apply shop bonuses
            const difficulty = getDifficultySettings(currentLevel);
            baseMoveLimit = difficulty.moveLimit;
            baseTimeLimit = difficulty.timeLimit;
            
            moveLimit = removeMoveLimit ? 0 : (baseMoveLimit + extraMoves);
            timeLimit = removeTimeLimit ? 0 : (baseTimeLimit + extraTime);
            
            // Reset shop bonuses after use
            extraMoves = 0;
            extraTime = 0;
            removeMoveLimit = false;
            removeTimeLimit = false;
            
            // Get icons
            const icons = levelIcons[currentLevel] || levelIcons[1];
            
            // Create pairs
            let iconPairs = [...icons, ...icons];
            
            // Shuffle
            for (let i = iconPairs.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [iconPairs[i], iconPairs[j]] = [iconPairs[j], iconPairs[i]];
            }
            
            // Create game board
            gameBoard = iconPairs.map((icon, index) => ({
                id: index,
                icon: icon,
                isFlipped: false,
                isMatched: false
            }));
            
            // Render cards
            gameBoard.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.id = card.id;
                cardElement.addEventListener('click', () => flipCard(card.id));
                cardElement.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    flipCard(card.id);
                });
                gameBoardElement.appendChild(cardElement);
            });
            
            // Reset game state
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            seconds = 0;
            gameStarted = false;
            clearInterval(timer);
            
            // Update UI
            updateStats();
            document.getElementById('message').textContent = difficulty.description;
            updateStarsDisplay();
        }
        
        // Show splash screen for special levels
        function showSplashScreen() {
            const difficulty = getDifficultySettings(currentLevel);
            if (currentLevel > 10) { // Show splash for levels 11+
                document.getElementById('splashLevel').textContent = currentLevel;
                document.getElementById('splashRules').textContent = difficulty.splashText;
                document.getElementById('splashScreen').classList.add('show');
            } else {
                initGame();
            }
        }
        
        function startGameFromSplash() {
            document.getElementById('splashScreen').classList.remove('show');
            initGame();
        }
        
        // Flip a card
        function flipCard(cardId) {
            const card = gameBoard[cardId];
            
            if (card.isFlipped || card.isMatched || flippedCards.length >= 2) {
                return;
            }
            
            // Check move limit
            if (moveLimit > 0 && moves >= moveLimit) {
                document.getElementById('message').textContent = 'âŒ Move limit reached!';
                return;
            }
            
            // Start timer and background music on first move
            if (!gameStarted) {
                startTimer();
                gameStarted = true;
                if (soundEnabled) {
                    playBackgroundMusic();
                }
            }
            
            // Flip the card
            card.isFlipped = true;
            flippedCards.push(cardId);
            
            // Update UI with animated emoji
            const cardElement = document.querySelector(`[data-id="${cardId}"]`);
            const animatedEmoji = document.createElement('span');
            animatedEmoji.className = 'animated-emoji';
            animatedEmoji.textContent = card.icon;
            cardElement.innerHTML = '';
            cardElement.appendChild(animatedEmoji);
            cardElement.classList.add('flipped');
            
            // Play sound
            playCardFlipSound();
            
            // Check for match if two cards are flipped
            if (flippedCards.length === 2) {
                moves++;
                updateStats();
                setTimeout(checkMatch, 500);
            }
        }
        
        // Check if flipped cards match
        function checkMatch() {
            const [firstId, secondId] = flippedCards;
            const firstCard = gameBoard[firstId];
            const secondCard = gameBoard[secondId];
            
            if (firstCard.icon === secondCard.icon) {
                firstCard.isMatched = true;
                secondCard.isMatched = true;
                matchedPairs++;
                
                const firstElement = document.querySelector(`[data-id="${firstId}"]`);
                const secondElement = document.querySelector(`[data-id="${secondId}"]`);
                firstElement.classList.add('matched');
                secondElement.classList.add('matched');
                
                playMatchSound();
                
                if (matchedPairs === 8) {
                    endLevel();
                }
            } else {
                firstCard.isFlipped = false;
                secondCard.isFlipped = false;
                
                const firstElement = document.querySelector(`[data-id="${firstId}"]`);
                const secondElement = document.querySelector(`[data-id="${secondId}"]`);
                firstElement.classList.remove('flipped');
                secondElement.classList.remove('flipped');
                firstElement.innerHTML = '';
                secondElement.innerHTML = '';
                
                playNoMatchSound();
            }
            
            flippedCards = [];
            
            if (moveLimit > 0 && moves >= moveLimit && matchedPairs < 8) {
                document.getElementById('message').textContent = 'âŒ Game Over! Move limit reached.';
                setTimeout(() => resetGame(), 3000);
            }
        }
        
        // Start the timer
        function startTimer() {
            if (timeLimit > 0) {
                document.getElementById('time').textContent = `${timeLimit}s`;
            }
            
            timer = setInterval(() => {
                seconds++;
                updateStats();
                
                if (timeLimit > 0) {
                    const remainingTime = timeLimit - seconds;
                    if (remainingTime <= 0) {
                        clearInterval(timer);
                        document.getElementById('message').textContent = 'â° Time\'s up! Game Over.';
                        setTimeout(() => resetGame(), 3000);
                    } else {
                        document.getElementById('time').textContent = `${remainingTime}s`;
                    }
                }
            }, 1000);
        }
        
        // End the current level
        function endLevel() {
            clearInterval(timer);
            stopBackgroundMusic();
            
            const starsEarned = calculateStarsEarned();
            totalStars += starsEarned;
            saveGameState();
            
            playWinSound();
            
            if (currentLevel < totalLevels) {
                const levelComplete = document.getElementById('levelComplete');
                const message = document.getElementById('levelCompleteMessage');
                message.innerHTML = `Level ${currentLevel} Complete!<br>Moves: ${moves}<br>Time: ${seconds}s`;
                document.getElementById('starsEarned').innerHTML = `â­ +${starsEarned} Stars!`;
                levelComplete.classList.add('show');
            } else {
                document.getElementById('message').textContent = `ğŸ† Game Complete! All ${totalLevels} levels finished!`;
            }
            
            updateStarsDisplay();
        }
        
        // Go to next level
        function nextLevel() {
            currentLevel++;
            saveGameState();
            const levelComplete = document.getElementById('levelComplete');
            levelComplete.classList.remove('show');
            showSplashScreen();
        }
        
        // Update statistics display
        function updateStats() {
            document.getElementById('moves').textContent = moves;
            if (timeLimit === 0) {
                document.getElementById('time').textContent = `${seconds}s`;
            }
            document.getElementById('level').textContent = `${currentLevel}/${totalLevels}`;
        }
        
        // Update stars display
        function updateStarsDisplay() {
            document.getElementById('starsDisplay').textContent = `â­ ${totalStars}`;
            document.getElementById('shopStars').textContent = totalStars;
        }
        
        // Reset the current game
        function resetGame() {
            clearInterval(timer);
            stopBackgroundMusic();
            showSplashScreen();
        }
        
        // Start a new game
        function newGame() {
            currentLevel = 1;
            saveGameState();
            showSplashScreen();
        }
        
        // Shop functions
        function openShop() {
            document.getElementById('shopModal').classList.add('show');
            updateStarsDisplay();
        }
        
        function closeShop() {
            document.getElementById('shopModal').classList.remove('show');
        }
        
        function buyExtraMoves() {
            if (totalStars >= 10) {
                totalStars -= 10;
                extraMoves += 5;
                saveGameState();
                updateStarsDisplay();
                alert('âœ… +5 Extra Moves purchased!');
            } else {
                alert('âŒ Not enough stars! Need 10 stars.');
            }
        }
        
        function buyExtraTime() {
            if (totalStars >= 15) {
                totalStars -= 15;
                extraTime += 15;
                saveGameState();
                updateStarsDisplay();
                alert('âœ… +15 Extra Seconds purchased!');
            } else {
                alert('âŒ Not enough stars! Need 15 stars.');
            }
        }
        
        function buyRemoveMoveLimit() {
            if (totalStars >= 25) {
                totalStars -= 25;
                removeMoveLimit = true;
                saveGameState();
                updateStarsDisplay();
                alert('âœ… Move limit removed for this game!');
            } else {
                alert('âŒ Not enough stars! Need 25 stars.');
            }
        }
        
        function buyRemoveTimeLimit() {
            if (totalStars >= 25) {
                totalStars -= 25;
                removeTimeLimit = true;
                saveGameState();
                updateStarsDisplay();
                alert('âœ… Time limit removed for this game!');
            } else {
                alert('âŒ Not enough stars! Need 25 stars.');
            }
        }
        
        // Initialize the game when page loads
        window.onload = function() {
            // loadGameState(); // Would work in real browser
            showSplashScreen();
            document.body.addEventListener('touchstart', initAudio, { once: true });
            document.body.addEventListener('click', initAudio, { once: true });
        };
    </script>
</body>
</html>
